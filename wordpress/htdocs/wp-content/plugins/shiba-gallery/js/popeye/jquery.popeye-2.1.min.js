(function($){$.fn.popeye=function(l){var m=$.extend({},$.fn.popeye.defaults,l);var n;function debug(a,b){if(window.console&&window.console.log&&m.debug){if(b=='info'&&window.console.info){window.console.info(a)}else if(b=='warn'&&window.console.warn){window.console.warn(a)}else{window.console.log(a)}}}return this.each(function(){$(this).addClass('ppy-active');var g=$(this),img=g.find('.ppy-imglist > li > a > img'),a=g.find('.ppy-imglist > li > a'),tot=img.length,singleImageMode=(tot==1)?true:false,ismouseover=false,enlarged=false,cur=0,eclass='ppy-expanded',lclass='ppy-loading',sclass='ppy-single-image',ppyPlaceholder=$('<div class="ppy-placeholder"></div>'),ppyStageWrap=$('<div class="ppy-stagewrap"></div>'),ppyCaptionWrap=$('<div class="ppy-captionwrap"></div>'),ppyOuter=g.find('.ppy-outer'),ppyStage=g.find('.ppy-stage'),ppyNav=g.find('.ppy-nav'),ppyPrev=g.find('.ppy-prev'),ppyNext=g.find('.ppy-next'),ppySwitchEnlarge=g.find('.ppy-switch-enlarge'),ppySwitchCompact=g.find('.ppy-switch-compact').addClass('ppy-hidden'),ppyPlay=g.find('.ppy-play'),ppyPause=g.find('.ppy-pause').addClass('ppy-hidden'),ppyCaption=g.find('.ppy-caption'),ppyText=g.find('.ppy-text'),ppyCounter=g.find('.ppy-counter'),ppyCurrent=g.find('.ppy-current'),ppyTotal=g.find('.ppy-total'),cssSelf={position:'absolute',width:'auto',height:'auto','max-width':(m.responsive)?'100%':'none',margin:0,top:0,left:(m.direction=='right')?0:'auto',right:(m.direction=='left')?0:'auto'},cssStage={height:ppyStage.height(),width:ppyStage.width()},cssCaption={height:ppyCaption.height()},origWidth=0,cssSelfRestore={'width':'auto','height':'auto','max-width':'100%',},cssStageRestore={'width':m.width+'px','height':m.height+'px','max-width':'100%',},cssPlaceholder={'width':m.width+'px','height':m.height+'px','float':g.css('float'),'max-width':(m.responsive)?'100%':'none','margin':'auto',};var j=[];for(var i=0;i<img.length;i++){var k=g.find('.ppy-imglist li').eq(i).find('.ppy-extcaption');j[i]=k.length>0?k.children():img[i].alt}if(!ppyStage.length||!ppyNav.length||!ppyOuter.length){debug('$.fn.popeye: Incorrect HTML structure','warn')}else if(tot===0){debug('$.fn.popeye: No images found','warn')}else{singleImageMode?debug('$.fn.popeye -> SingleImageMode started'):debug('$.fn.popeye -> '+tot+' thumbnails found.');init()}function showThumb(i,b){b=b||false;i=i||cur;var c={backgroundImage:'url('+img[i].src+')'};var d={height:'+=0'};if(enlarged){hideCaption();ppyStage.fadeTo((m.duration/2),0).animate(cssStage,{queue:false,duration:m.duration,easing:m.easing,complete:function(){enlarged=false;debug('$.fn.showThumb: Entering COMPACT MODE','info');g.removeClass(eclass);g.css('z-index','').parent().css('z-index','');ppySwitchEnlarge.removeClass('ppy-hidden');ppySwitchCompact.addClass('ppy-hidden');showThumb();$(this).fadeTo((m.duration/2),1)}})}else{if(b){ppyStageWrap.addClass(lclass);ppyStage.fadeTo((m.duration/2),0);var e=new Image();e.onload=function(){debug('$.fn.popeye.showThumb: Thumbnail '+i+' loaded','info');ppyStageWrap.removeClass(lclass);ppyStage.animate(d,1,'linear',function(){ppyStage.css(c);$(this).fadeTo((m.duration/2),1);if(m.caption=='hover'&&ismouseover){showCaption(j[i])}else if(m.caption=='permanent'){updateCaption(j[i])}updateCounter()});e.onload=function(){}};e.src=img[i].src}else{ppyStage.css(c);updateCounter();showCaption(j[i],true);if(m.responsive){g.css(cssSelfRestore);ppyStage.css(cssStageRestore);adjustHeight()}}var f=new Image();f.onload=function(){debug('$.fn.popeye.showThumb: Image '+i+' loaded','info');f.onload=function(){}};f.src=a[i].href}}function adjustHeight(){if(enlarged){return}if(m.aspect){if(ppyOuter.width()==origWidth)return;origWidth=ppyOuter.width();var h=Math.floor(m.aspect*ppyOuter.width());g.height(h);ppyStage.height(h)}}function showImage(i){i=i||cur;g.css('max-width','none');ppyStage.css('max-width','none');ppyStageWrap.addClass(lclass);ppyStage.fadeTo((m.duration/2),0);var d=$('.'+eclass);d.css('z-index',m.zindex-1);g.css('z-index',m.zindex).parent().css('z-index',m.zindex);var e=new Image();e.onload=function(){ppyStageWrap.removeClass(lclass);var b={width:e.width,height:e.height};var c={backgroundImage:'url('+a[i].href+')',backgroundPosition:'left top'};hideCaption();ppyStage.animate(b,{queue:false,duration:m.duration,easing:m.easing,complete:function(){if(m.navigation=='hover'&&ismouseover){showNav()}enlarged=true;debug('$.fn.popeye.showImage: Entering ENLARGED MODE','info');g.addClass(eclass);ppySwitchCompact.removeClass('ppy-hidden');ppySwitchEnlarge.addClass('ppy-hidden');updateCounter();$(this).css(c).fadeTo((m.duration/2),1);showCaption(j[i]);preloadNeighbours()}})};e.src=a[i].href}function updateCounter(i){i=i||cur;ppyTotal.text(tot);ppyCurrent.text(i+1);debug('$.fn.popeye.updateCounter: Displaying image '+(i+1)+' of '+tot)}function preloadNeighbours(i){i=i||cur;var b=new Image();var c=new Image();var d=i;if(d<(tot-1)){d++}else{d=0}b.src=a[d].href;d=i;if(d<=0){d=tot-1}else{d--}c.src=a[d].href}function showNav(){ppyNav.stop().fadeTo(150,m.opacity)}function hideNav(){ppyNav.stop().fadeTo(150,0)}function updateCaption(a){if(m.caption){ppyText.children().detach();ppyText.append(a)}}function showCaption(a,b){if(a&&m.caption){updateCaption(a);debug('$.fn.popeye.showCaption -> ppyCaptionWrap.outerHeight(true): '+ppyCaptionWrap.outerHeight(true));var c={visibility:'visible'};ppyCaption.css(c);if(m.caption==='permanent'&&!enlarged){ppyCaption.css(cssCaption)}else{ppyCaption.animate({'height':ppyCaptionWrap.outerHeight(true)},{queue:false,duration:90,easing:m.easing})}}else if(!a&&!b){hideCaption()}}function hideCaption(){var a={visibility:'hidden',overflow:'hidden'};ppyCaption.animate({'height':'0px'},{queue:false,duration:90,easing:m.easing,complete:function(){ppyCaption.css(a)}})}function previous(){if(cur<=0){cur=tot-1}else{cur--}if(enlarged){showImage(cur)}else{showThumb(cur,true)}return cur}function next(){if(cur<(tot-1)){cur++}else{cur=0}if(enlarged){showImage(cur)}else{showThumb(cur,true)}return cur}function init(){ppyPlaceholder.css(cssPlaceholder);g.css(cssSelf);g.wrap(ppyPlaceholder);ppyStageWrap=ppyStage.wrap(ppyStageWrap).parent();ppyCaptionWrap=ppyCaption.wrapInner(ppyCaptionWrap).children().eq(0);showThumb();if(m.navigation=='hover'){hideNav();g.hover(function(){showNav()},function(){hideNav()});ppyNav.hover(function(){showNav()},function(){hideNav()})}if(!singleImageMode){ppyPrev.click(function(e){e.stopPropagation();previous()});ppyNext.click(function(e){e.stopPropagation();next()})}else{g.addClass(sclass);ppyPrev.remove();ppyNext.remove();ppyPlay.remove();ppyPause.remove();ppyCounter.remove()}if(m.caption=='hover'){hideCaption();g.hover(function(){showCaption(j[cur])},function(){hideCaption(true)})}ppySwitchEnlarge.click(function(e){e.stopPropagation();showImage();return false});ppySwitchCompact.click(function(e){e.stopPropagation();showThumb(cur);return false});if(m.active){ppyStage.click(function(){if(enlarged){showThumb(cur)}else{showImage()}})}else{ppyStage.click(function(){next()})}if(m.aspect){shibaResizeFunctions.push(adjustHeight.bind(this))}ppyPlay.click(function(e){e.stopPropagation();ppyPause.removeClass('ppy-hidden');ppyPlay.addClass('ppy-hidden');n=window.setInterval(function(){next()},m.slidespeed);return false});ppyPause.click(function(e){e.stopPropagation();ppyPlay.removeClass('ppy-hidden');ppyPause.addClass('ppy-hidden');window.clearInterval(n);return false});g.mouseenter(function(){ismouseover=true}).mouseleave(function(){ismouseover=false});if(m.autoslide){ppyPlay.trigger('click')}}})};$.fn.popeye.defaults={navigation:'hover',caption:'hover',zindex:10000,direction:'right',duration:240,opacity:0.8,easing:'swing',slidespeed:2000,autoslide:false,enlarge:false,debug:false}})(jQuery);jQuery('head').append('<style type="text/css"> .ppy-imglist { position: absolute; top: -1000em; left: -1000em; } </style>');