(function($){var u,window=this,doc=window.document,$doc=$(doc),$win=$(window),protoArray=Array.prototype,VERSION=1.27,DEBUG=true,TIMEOUT=30000,DUMMY=false,NAV=navigator.userAgent.toLowerCase(),HASH=window.location.hash.replace(/#\//,''),F=function(){},FALSE=function(){return false},IE=(function(){var v=3,div=doc.createElement('div'),all=div.getElementsByTagName('i');do{div.innerHTML='<!--[if gt IE '+(++v)+']><i></i><![endif]-->'}while(all[0]);return v>4?v:u}()),DOM=function(){return{html:doc.documentElement,body:doc.body,head:doc.getElementsByTagName('head')[0],title:doc.title}},_eventlist='data ready thumbnail loadstart loadfinish image play pause progress '+'fullscreen_enter fullscreen_exit idle_enter idle_exit rescale '+'lightbox_open lightbox_close lightbox_image',_events=(function(){var b=[];$.each(_eventlist.split(' '),function(i,a){b.push(a);if(/_/.test(a)){b.push(a.replace(/_/g,''))}});return b}()),_legacyOptions=function(c){var n;if(typeof c!=='object'){return c}$.each(c,function(a,b){if(/^[a-z]+_/.test(a)){n='';$.each(a.split('_'),function(i,k){n+=i>0?k.substr(0,1).toUpperCase()+k.substr(1):k});c[n]=b;delete c[a]}});return c},_patchEvent=function(a){if($.inArray(a,_events)>-1){return Galleria[a.toUpperCase()]}return a},_video={youtube:{reg:/https?:\/\/(?:[a-zA_Z]{2,3}.)?(?:youtube\.com\/watch\?)((?:[\w\d\-\_\=]+&amp;(?:amp;)?)*v(?:&lt;[A-Z]+&gt;)?=([0-9a-zA-Z\-\_]+))/i,embed:function(a){return'http://www.youtube.com/embed/'+a},getThumb:function(b,c,d){d=d||F;$.getJSON('http://gdata.youtube.com/feeds/api/videos/'+b+'?v=2&alt=json-in-script&callback=?',function(a){try{c(a.entry.media$group.media$thumbnail[0].url)}catch(e){d()}}).error(d)}},vimeo:{reg:/https?:\/\/(?:www\.)?(vimeo\.com)\/(?:hd#)?([0-9]+)/i,embed:function(a){return'http://player.vimeo.com/video/'+a},getThumb:function(b,c,d){d=d||F;$.getJSON('http://vimeo.com/api/v2/video/'+b+'.json?callback=?',function(a){try{c(a[0].thumbnail_medium)}catch(e){d()}}).error(d)}},dailymotion:{reg:/https?:\/\/(?:www\.)?(dailymotion\.com)\/video\/([^_]+)/,embed:function(a){return'http://www.dailymotion.com/embed/video/'+a},getThumb:function(b,c,d){d=d||F;$.getJSON('https://api.dailymotion.com/video/'+b+'?fields=thumbnail_medium_url&callback=?',function(a){try{c(a.thumbnail_medium_url)}catch(e){d()}}).error(d)}}},_videoTest=function(a){var b;for(var v in _video){b=a&&a.match(_video[v].reg);if(b&&b.length){return{id:b[2],provider:v}}}return false},_timeouts={trunk:{},add:function(a,b,c,d){a=a||new Date().getTime();d=d||false;this.clear(a);if(d){var e=b;b=function(){e();_timeouts.add(a,b,c)}}this.trunk[a]=window.setTimeout(b,c)},clear:function(a){var b=function(i){window.clearTimeout(this.trunk[i]);delete this.trunk[i]},i;if(!!a&&a in this.trunk){b.call(_timeouts,a)}else if(typeof a==='undefined'){for(i in this.trunk){if(this.trunk.hasOwnProperty(i)){b.call(_timeouts,i)}}}}},_galleries=[],_instances=[],_hasError=false,_canvas=false,_pool=[],_themeLoad=function(b){Galleria.theme=b;$.each(_pool,function(i,a){if(!a._initialized){a._init.call(a)}})},Utils=(function(){return{array:function(a){return protoArray.slice.call(a,0)},create:function(a,b){b=b||'div';var c=doc.createElement(b);c.className=a;return c},getScriptPath:function(a){a=a||$('script:last').attr('src');var b=a.split('/');if(b.length==1){return''}b.pop();return b.join('/')+'/'},animate:(function(){var j=(function(a){var b='transition WebkitTransition MozTransition OTransition'.split(' '),i;if(window.opera){return false}for(i=0;b[i];i++){if(typeof a[b[i]]!=='undefined'){return b[i]}}return false}((doc.body||doc.documentElement).style));var k={MozTransition:'transitionend',OTransition:'oTransitionEnd',WebkitTransition:'webkitTransitionEnd',transition:'transitionend'}[j];var l={_default:[0.25,0.1,0.25,1],galleria:[0.645,0.045,0.355,1],galleriaIn:[0.55,0.085,0.68,0.53],galleriaOut:[0.25,0.46,0.45,0.94],ease:[0.25,0,0.25,1],linear:[0.25,0.25,0.75,0.75],'ease-in':[0.42,0,1,1],'ease-out':[0,0,0.58,1],'ease-in-out':[0.42,0,0.58,1]};var n=function(a,b,c){var d={};c=c||'transition';$.each('webkit moz ms o'.split(' '),function(){d['-'+this+'-'+c]=b});a.css(d)};var o=function(a){n(a,'none','transition');if(Galleria.WEBKIT&&Galleria.TOUCH){n(a,'translate3d(0,0,0)','transform');if(a.data('revert')){a.css(a.data('revert'));a.data('revert',null)}}};var q,strings,easing,syntax,revert,form,css;return function(f,g,h){h=$.extend({duration:400,complete:F,stop:false},h);f=$(f);if(!h.duration){f.css(g);h.complete.call(f[0]);return}if(!j){f.animate(g,h);return}if(h.stop){f.unbind(k);o(f)}q=false;$.each(g,function(a,b){css=f.css(a);if(Utils.parseValue(css)!=Utils.parseValue(b)){q=true}f.css(a,css)});if(!q){window.setTimeout(function(){h.complete.call(f[0])},h.duration);return}strings=[];easing=h.easing in l?l[h.easing]:l._default;syntax=' '+h.duration+'ms'+' cubic-bezier('+easing.join(',')+')';window.setTimeout((function(b,c,d,e){return function(){b.one(c,(function(a){return function(){o(a);h.complete.call(a[0])}}(b)));if(Galleria.WEBKIT&&Galleria.TOUCH){revert={};form=[0,0,0];$.each(['left','top'],function(i,m){if(m in d){form[i]=(Utils.parseValue(d[m])-Utils.parseValue(b.css(m)))+'px';revert[m]=d[m];delete d[m]}});if(form[0]||form[1]){b.data('revert',revert);strings.push('-webkit-transform'+e);n(b,'translate3d('+form.join(',')+')','transform')}}$.each(d,function(p,a){strings.push(p+e)});n(b,strings.join(','));b.css(d)}}(f,k,g,syntax)),2)}}()),removeAlpha:function(a){if(IE<9&&a){var b=a.style,currentStyle=a.currentStyle,filter=currentStyle&&currentStyle.filter||b.filter||"";if(/alpha/.test(filter)){b.filter=filter.replace(/alpha\([^)]*\)/i,'')}}},forceStyles:function(a,b){a=$(a);if(a.attr('style')){a.data('styles',a.attr('style')).removeAttr('style')}a.css(b)},revertStyles:function(){$.each(Utils.array(arguments),function(i,a){a=$(a);a.removeAttr('style');a.attr('style','');if(a.data('styles')){a.attr('style',a.data('styles')).data('styles',null)}})},moveOut:function(a){Utils.forceStyles(a,{position:'absolute',left:-10000})},moveIn:function(){Utils.revertStyles.apply(Utils,Utils.array(arguments))},elem:function(a){if(a instanceof $){return{$:a,dom:a[0]}}else{return{$:$(a),dom:a}}},hide:function(a,b,c){c=c||F;var d=Utils.elem(a),$elem=d.$;a=d.dom;if(!$elem.data('opacity')){$elem.data('opacity',$elem.css('opacity'))}var e={opacity:0};if(b){var f=IE<9&&a?function(){Utils.removeAlpha(a);a.style.visibility='hidden';c.call(a)}:c;Utils.animate(a,e,{duration:b,complete:f,stop:true})}else{if(IE<9&&a){Utils.removeAlpha(a);a.style.visibility='hidden'}else{$elem.css(e)}}},show:function(a,b,c){c=c||F;var d=Utils.elem(a),$elem=d.$;a=d.dom;var e=parseFloat($elem.data('opacity'))||1,style={opacity:e};if(b){if(IE<9){$elem.css('opacity',0);a.style.visibility='visible'}var f=IE<9&&a?function(){if(style.opacity==1){Utils.removeAlpha(a)}c.call(a)}:c;Utils.animate(a,style,{duration:b,complete:f,stop:true})}else{if(IE<9&&style.opacity==1&&a){Utils.removeAlpha(a);a.style.visibility='visible'}else{$elem.css(style)}}},optimizeTouch:(function(){var b,evs,fakes,travel,evt={},handler=function(e){e.preventDefault();evt=$.extend({},e,true)},attach=function(){this.evt=evt},fake=function(){this.handler.call(b,this.evt)};return function(a){$(a).bind('touchend',function(e){b=e.target;travel=true;while(b.parentNode&&b!=e.currentTarget&&travel){evs=$(b).data('events');fakes=$(b).data('fakes');if(evs&&'click'in evs){travel=false;e.preventDefault();$(b).click(handler).click();evs.click.pop();$.each(evs.click,attach);$(b).data('fakes',evs.click);delete evs.click}else if(fakes){travel=false;e.preventDefault();$.each(fakes,fake)}b=b.parentNode}})}}()),addTimer:function(){_timeouts.add.apply(_timeouts,Utils.array(arguments));return this},clearTimer:function(){_timeouts.clear.apply(_timeouts,Utils.array(arguments));return this},wait:function(a){a=$.extend({until:FALSE,success:F,error:function(){Galleria.raise('Could not complete wait function.')},timeout:3000},a);var b=Utils.timestamp(),elapsed,now,fn=function(){now=Utils.timestamp();elapsed=now-b;if(a.until(elapsed)){a.success();return false}if(typeof a.timeout=='number'&&now>=b+a.timeout){a.error();return false}window.setTimeout(fn,10)};window.setTimeout(fn,10)},toggleQuality:function(a,b){if((IE!==7&&IE!==8)||!a||a.nodeName.toUpperCase()!='IMG'){return}if(typeof b==='undefined'){b=a.style.msInterpolationMode==='nearest-neighbor'}a.style.msInterpolationMode=b?'bicubic':'nearest-neighbor'},insertStyleTag:function(a){var b=doc.createElement('style');DOM().head.appendChild(b);if(b.styleSheet){b.styleSheet.cssText=a}else{var c=doc.createTextNode(a);b.appendChild(c)}},loadScript:function(a,b){var c=false,script=$('<scr'+'ipt>').attr({src:a,async:true}).get(0);script.onload=script.onreadystatechange=function(){if(!c&&(!this.readyState||this.readyState==='loaded'||this.readyState==='complete')){c=true;script.onload=script.onreadystatechange=null;if(typeof b==='function'){b.call(this,this)}}};DOM().head.appendChild(script)},parseValue:function(a){if(typeof a==='number'){return a}else if(typeof a==='string'){var b=a.match(/\-?\d|\./g);return b&&b.constructor===Array?b.join('')*1:0}else{return 0}},timestamp:function(){return new Date().getTime()},loadCSS:function(c,d,f){var g,ready=false,length,lastChance=function(){var a=new Image();a.onload=a.onerror=function(e){a=null;ready=true};a.src=c};$('link[rel=stylesheet]').each(function(){if(new RegExp(c).test(this.href)){g=this;return false}});if(typeof d==='function'){f=d;d=u}f=f||F;if(g){f.call(g,g);return g}length=doc.styleSheets.length;if($('#'+d).length){$('#'+d).attr('href',c);length--;ready=true}else{g=$('<link>').attr({rel:'stylesheet',href:c,id:d}).get(0);window.setTimeout(function(){var a=$('link[rel="stylesheet"], style');if(a.length){a.get(0).parentNode.insertBefore(g,a[0])}else{DOM().head.appendChild(g)}if(IE){if(length>=31){Galleria.raise('You have reached the browser stylesheet limit (31)',true);return}g.onreadystatechange=function(e){if(!ready&&(!this.readyState||this.readyState==='loaded'||this.readyState==='complete')){ready=true}}}else{var b=doc.createElement('a'),loc=window.location;b.href=c;if(!(/file/.test(loc.protocol))&&loc.hostname==b.hostname&&loc.port==b.port&&loc.protocol==b.protocol){$.ajax({url:c,success:function(){ready=true},error:lastChance})}else{lastChance()}}},10)}if(typeof f==='function'){Utils.wait({until:function(){return ready&&doc.styleSheets.length>length},success:function(){window.setTimeout(function(){f.call(g,g)},100)},error:function(){Galleria.raise('Theme CSS could not load',true)},timeout:10000})}return g}}}()),_transitions=(function(){var g=function(b,c,d,e){var f=this.getOptions('easing'),distance=this.getStageWidth(),from={left:distance*(b.rewind?-1:1)},to={left:0};if(d){from.opacity=0;to.opacity=1}else{from.opacity=1}$(b.next).css(from);Utils.animate(b.next,to,{duration:b.speed,complete:(function(a){return function(){c();a.css({left:0})}}($(b.next).add(b.prev))),queue:false,easing:f});if(e){b.rewind=!b.rewind}if(b.prev){from={left:0};to={left:distance*(b.rewind?1:-1)};if(d){from.opacity=1;to.opacity=0}$(b.prev).css(from);Utils.animate(b.prev,to,{duration:b.speed,queue:false,easing:f,complete:function(){$(this).css('opacity',0)}})}};return{fade:function(a,b){$(a.next).css({opacity:0,left:0}).show();Utils.animate(a.next,{opacity:1},{duration:a.speed,complete:b});if(a.prev){$(a.prev).css('opacity',1).show();Utils.animate(a.prev,{opacity:0},{duration:a.speed})}},flash:function(a,b){$(a.next).css({opacity:0,left:0});if(a.prev){Utils.animate(a.prev,{opacity:0},{duration:a.speed/2,complete:function(){Utils.animate(a.next,{opacity:1},{duration:a.speed,complete:b})}})}else{Utils.animate(a.next,{opacity:1},{duration:a.speed,complete:b})}},pulse:function(a,b){if(a.prev){$(a.prev).hide()}$(a.next).css({opacity:0,left:0}).show();Utils.animate(a.next,{opacity:1},{duration:a.speed,complete:b})},slide:function(a,b){g.apply(this,Utils.array(arguments))},fadeslide:function(a,b){g.apply(this,Utils.array(arguments).concat([true]))},doorslide:function(a,b){g.apply(this,Utils.array(arguments).concat([false,true]))}}}());Galleria=function(){var g=this;this._options={};this._playing=false;this._playtime=5000;this._active=null;this._queue={length:0};this._data=[];this._dom={};this._thumbnails=[];this._layers=[];this._initialized=false;this._firstrun=false;this._stageWidth=0;this._stageHeight=0;this._target=u;this._id=parseInt(Math.random()*10000,10);var j='container stage images image-nav image-nav-left image-nav-right '+'info info-text info-title info-description '+'thumbnails thumbnails-list thumbnails-container thumb-nav-left thumb-nav-right '+'loader counter tooltip',spans='current total';$.each(j.split(' '),function(i,a){g._dom[a]=Utils.create('galleria-'+a)});this.$('container').addClass('shiba-outer');this.$('stage').addClass('shiba-stage');$.each(spans.split(' '),function(i,a){g._dom[a]=Utils.create('galleria-'+a,'span')});var k=this._keyboard={keys:{'UP':38,'DOWN':40,'LEFT':37,'RIGHT':39,'RETURN':13,'ESCAPE':27,'BACKSPACE':8,'SPACE':32},map:{},bound:false,press:function(e){var a=e.keyCode||e.which;if(a in k.map&&typeof k.map[a]==='function'){k.map[a].call(g,e)}},attach:function(a){var b,up;for(b in a){if(a.hasOwnProperty(b)){up=b.toUpperCase();if(up in k.keys){k.map[k.keys[up]]=a[b]}else{k.map[up]=a[b]}}}if(!k.bound){k.bound=true;$doc.bind('keydown',k.press)}},detach:function(){k.bound=false;k.map={};$doc.unbind('keydown',k.press)}};var l=this._controls={0:u,1:u,active:0,swap:function(){l.active=l.active?0:1},getActive:function(){return l[l.active]},getNext:function(){return l[1-l.active]}};var m=this._carousel={next:g.$('thumb-nav-right'),prev:g.$('thumb-nav-left'),width:0,current:0,max:0,hooks:[],update:function(){var w=0,h=0,hooks=[0];$.each(g._thumbnails,function(i,a){if(a.ready){w+=a.outerWidth||$(a.container).outerWidth(true);hooks[i+1]=w;h=Math.max(h,a.outerHeight||$(a.container).outerHeight(true))}});g.$('thumbnails').css({width:w,height:h});m.max=w;m.hooks=hooks;m.width=g.$('thumbnails-list').width();m.setClasses();g.$('thumbnails-container').toggleClass('galleria-carousel',w>m.width);m.width=g.$('thumbnails-list').width()},bindControls:function(){var i;m.next.bind('click',function(e){e.preventDefault();if(g._options.carouselSteps==='auto'){for(i=m.current;i<m.hooks.length;i++){if(m.hooks[i]-m.hooks[m.current]>m.width){m.set(i-2);break}}}else{m.set(m.current+g._options.carouselSteps)}});m.prev.bind('click',function(e){e.preventDefault();if(g._options.carouselSteps==='auto'){for(i=m.current;i>=0;i--){if(m.hooks[m.current]-m.hooks[i]>m.width){m.set(i+2);break}else if(i===0){m.set(0);break}}}else{m.set(m.current-g._options.carouselSteps)}})},set:function(i){i=Math.max(i,0);while(m.hooks[i-1]+m.width>=m.max&&i>=0){i--}m.current=i;m.animate()},getLast:function(i){return(i||m.current)-1},follow:function(i){if(i===0||i===m.hooks.length-2){m.set(i);return}var a=m.current;while(m.hooks[a]-m.hooks[m.current]<m.width&&a<=m.hooks.length){a++}if(i-1<m.current){m.set(i-1)}else if(i+2>a){m.set(i-a+m.current+2)}},setClasses:function(){m.prev.toggleClass('disabled',!m.current);m.next.toggleClass('disabled',m.hooks[m.current]+m.width>=m.max)},animate:function(a){m.setClasses();var b=m.hooks[m.current]*-1;if(isNaN(b)){return}Utils.animate(g.get('thumbnails'),{left:b},{duration:g._options.carouselSpeed,easing:g._options.easing,queue:false})}};var o=this._tooltip={initialized:false,open:false,timer:'tooltip'+g._id,swapTimer:'swap'+g._id,init:function(){o.initialized=true;var a='.galleria-tooltip{padding:3px 8px;max-width:50%;background:#ffe;color:#000;z-index:3;position:absolute;font-size:11px;line-height:1.3'+'opacity:0;box-shadow:0 0 2px rgba(0,0,0,.4);-moz-box-shadow:0 0 2px rgba(0,0,0,.4);-webkit-box-shadow:0 0 2px rgba(0,0,0,.4);}';Utils.insertStyleTag(a);g.$('tooltip').css('opacity',0.8);Utils.hide(g.get('tooltip'))},move:function(e){var a=g.getMousePosition(e).x,mouseY=g.getMousePosition(e).y,$elem=g.$('tooltip'),x=a,y=mouseY,height=$elem.outerHeight(true)+1,width=$elem.outerWidth(true),limitY=height+15;var b=g.$('container').width()-width-2,maxY=g.$('container').height()-height-2;if(!isNaN(x)&&!isNaN(y)){x+=10;y-=30;x=Math.max(0,Math.min(b,x));y=Math.max(0,Math.min(maxY,y));if(mouseY<limitY){y=limitY}$elem.css({left:x,top:y})}},bind:function(c,d){if(Galleria.TOUCH){return}if(!o.initialized){o.init()}var e=function(a,b){o.define(a,b);$(a).hover(function(){Utils.clearTimer(o.swapTimer);g.$('container').unbind('mousemove',o.move).bind('mousemove',o.move).trigger('mousemove');o.show(a);Utils.addTimer(o.timer,function(){g.$('tooltip').stop().show().animate({opacity:1});o.open=true},o.open?0:500)},function(){g.$('container').unbind('mousemove',o.move);Utils.clearTimer(o.timer);g.$('tooltip').stop().animate({opacity:0},200,function(){g.$('tooltip').hide();Utils.addTimer(o.swapTimer,function(){o.open=false},1000)})}).click(function(){$(this).trigger('mouseout')})};if(typeof d==='string'){e((c in g._dom?g.get(c):c),d)}else{$.each(c,function(a,b){e(g.get(a),b)})}},show:function(b){b=$(b in g._dom?g.get(b):b);var c=b.data('tt'),mouseup=function(e){window.setTimeout((function(a){return function(){o.move(a)}}(e)),10);b.unbind('mouseup',mouseup)};c=typeof c==='function'?c():c;if(!c){return}g.$('tooltip').html(c.replace(/\s/,'&nbsp;'));b.bind('mouseup',mouseup)},define:function(a,b){if(typeof b!=='function'){var s=b;b=function(){return s}}a=$(a in g._dom?g.get(a):a).data('tt',b);o.show(a)}};var q=this._fullscreen={scrolled:0,crop:u,transition:u,active:false,keymap:g._keyboard.map,os:{callback:F,support:(function(){var a=DOM().html;return a.requestFullscreen||a.mozRequestFullScreen||a.webkitRequestFullScreen}()),enter:function(a){q.os.callback=a||F;var b=DOM().html;if(b.requestFullscreen){b.requestFullscreen()}else if(b.mozRequestFullScreen){b.mozRequestFullScreen()}else if(b.webkitRequestFullScreen){b.webkitRequestFullScreen()}},exit:function(a){q.os.callback=a||F;if(doc.exitFullscreen){doc.exitFullscreen()}else if(doc.mozCancelFullScreen){doc.mozCancelFullScreen()}else if(doc.webkitCancelFullScreen){doc.webkitCancelFullScreen()}},listen:function(){if(!q.os.support){return}var a=function(){if(doc.fullscreen||doc.mozFullScreen||doc.webkitIsFullScreen){q._enter(q.os.callback)}else{q._exit(q.os.callback)}};doc.addEventListener('fullscreenchange',a,false);doc.addEventListener('mozfullscreenchange',a,false);doc.addEventListener('webkitfullscreenchange',a,false)}},enter:function(a){if(g._options.trueFullscreen&&q.os.support){q.os.enter(a)}else{q._enter(a)}},_enter:function(d){q.active=true;Utils.hide(g.getActiveImage());g.$('container').addClass('fullscreen');q.scrolled=$win.scrollTop();Utils.forceStyles(g.get('container'),{position:'fixed',top:0,left:0,width:'100%',height:'100%',zIndex:10000});var e={height:'100%',overflow:'hidden',margin:0,padding:0},data=g.getData(),options=g._options;Utils.forceStyles(DOM().html,e);Utils.forceStyles(DOM().body,e);q.keymap=$.extend({},g._keyboard.map);g.attachKeyboard({escape:g.exitFullscreen,right:g.next,left:g.prev});q.crop=options.imageCrop;if(options.fullscreenCrop!=u){options.imageCrop=options.fullscreenCrop}if(data&&data.big&&data.image!==data.big){var f=new Galleria.Picture(),cached=f.isCached(data.big),index=g.getIndex(),thumb=g._thumbnails[index];g.trigger({type:Galleria.LOADSTART,cached:cached,rewind:false,index:index,imageTarget:g.getActiveImage(),thumbTarget:thumb,galleriaData:data});f.load(data.big,function(c){g._scaleImage(c,{complete:function(a){g.trigger({type:Galleria.LOADFINISH,cached:cached,index:index,rewind:false,imageTarget:a.image,thumbTarget:thumb});var b=g._controls.getActive().image;if(b){$(b).width(a.image.width).height(a.image.height).attr('style',$(a.image).attr('style')).attr('src',a.image.src)}}})})}g.rescale(function(){Utils.addTimer(false,function(){Utils.show(g.getActiveImage());if(typeof d==='function'){d.call(g)}},100);g.trigger(Galleria.FULLSCREEN_ENTER)});$win.resize(function(){q.scale()})},scale:function(){g.rescale()},exit:function(a){if(g._options.trueFullscreen&&q.os.support){q.os.exit(a)}else{q._exit(a)}},_exit:function(b){q.active=false;Utils.hide(g.getActiveImage());g.$('container').removeClass('fullscreen');Utils.revertStyles(g.get('container'),DOM().html,DOM().body);window.scrollTo(0,q.scrolled);g.detachKeyboard();g.attachKeyboard(q.keymap);g._options.imageCrop=q.crop;var c=g.getData().big,image=g._controls.getActive().image;if(!g.getData().iframe&&image&&c&&c==image.src){window.setTimeout(function(a){return function(){image.src=a}}(g.getData().image),1)}g.rescale(function(){Utils.addTimer(false,function(){Utils.show(g.getActiveImage());if(typeof b==='function'){b.call(g)}$win.trigger('resize')},50);g.trigger(Galleria.FULLSCREEN_EXIT)});$win.unbind('resize',q.scale)}};q.os.listen();var r=this._idle={timer:'idle'+g._id,trunk:[],bound:false,add:function(a,b){if(!a){return}if(!r.bound){r.addEvent()}a=$(a);var c={},style;for(style in b){if(b.hasOwnProperty(style)){c[style]=a.css(style)}}a.data('idle',{from:c,to:b,complete:true,busy:false});r.addTimer();r.trunk.push(a)},remove:function(b){b=jQuery(b);$.each(r.trunk,function(i,a){if(a&&a.length&&!a.not(b).length){g._idle.show(b);g._idle.trunk.splice(i,1)}});if(!r.trunk.length){r.removeEvent();Utils.clearTimer(r.timer)}},addEvent:function(){r.bound=true;g.$('container').bind('mousemove click',r.showAll)},removeEvent:function(){r.bound=false;g.$('container').unbind('mousemove click',r.showAll)},addTimer:function(){Utils.addTimer(r.timer,function(){r.hide()},g._options.idleTime)},hide:function(){if(!g._options.idleMode||g.getIndex()===false||g.getData().iframe){return}g.trigger(Galleria.IDLE_ENTER);$.each(r.trunk,function(i,a){var b=a.data('idle');if(!b){return}a.data('idle').complete=false;Utils.animate(a,b.to,{duration:g._options.idleSpeed})})},showAll:function(){Utils.clearTimer(r.timer);$.each(r.trunk,function(i,a){r.show(a)})},show:function(a){var b=a.data('idle');if(!b.busy&&!b.complete){b.busy=true;g.trigger(Galleria.IDLE_EXIT);Utils.clearTimer(r.timer);Utils.animate(a,b.from,{duration:g._options.idleSpeed/2,complete:function(){$(this).data('idle').busy=false;$(this).data('idle').complete=true}})}r.addTimer()}};var t=this._lightbox={width:0,height:0,initialized:false,active:null,image:null,elems:{},keymap:false,init:function(){g.trigger(Galleria.LIGHTBOX_OPEN);if(t.initialized){return}t.initialized=true;var f='overlay box content shadow title info close prevholder prev nextholder next counter image',el={},op=g._options,css='',abs='position:absolute;',prefix='lightbox-',cssMap={overlay:'position:fixed;display:none;opacity:'+op.overlayOpacity+';filter:alpha(opacity='+(op.overlayOpacity*100)+');top:0;left:0;width:100%;height:100%;background:'+op.overlayBackground+';z-index:99990',box:'position:fixed;display:none;width:400px;height:400px;top:50%;left:50%;margin-top:-200px;margin-left:-200px;z-index:99991',shadow:abs+'background:#000;width:100%;height:100%;',content:abs+'background-color:#fff;top:10px;left:10px;right:10px;bottom:10px;overflow:hidden',info:abs+'bottom:10px;left:10px;right:10px;color:#444;font:11px/13px arial,sans-serif;height:13px',close:abs+'top:10px;right:10px;height:20px;width:20px;background:#fff;text-align:center;cursor:pointer;color:#444;font:16px/22px arial,sans-serif;z-index:99999',image:abs+'top:10px;left:10px;right:10px;bottom:30px;overflow:hidden;display:block;',prevholder:abs+'width:50%;top:0;bottom:40px;cursor:pointer;',nextholder:abs+'width:50%;top:0;bottom:40px;right:-1px;cursor:pointer;',prev:abs+'top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;left:20px;display:none;text-align:center;color:#000;font:bold 16px/36px arial,sans-serif',next:abs+'top:50%;margin-top:-20px;height:40px;width:30px;background:#fff;right:20px;left:auto;display:none;font:bold 16px/36px arial,sans-serif;text-align:center;color:#000',title:'float:left',counter:'float:right;margin-left:8px;'},hover=function(a){return a.hover(function(){$(this).css('color','#bbb')},function(){$(this).css('color','#444')})},appends={};if(IE&&IE>7){cssMap.nextholder+='background:#000;filter:alpha(opacity=0);';cssMap.prevholder+='background:#000;filter:alpha(opacity=0);'}$.each(cssMap,function(a,b){css+='.galleria-'+prefix+a+'{'+b+'}'});css+='.galleria-'+prefix+'box.iframe .galleria-'+prefix+'prevholder,'+'.galleria-'+prefix+'box.iframe .galleria-'+prefix+'nextholder{'+'width:100px;height:100px;top:50%;margin-top:-70px}';Utils.insertStyleTag(css);$.each(f.split(' '),function(i,a){g.addElement('lightbox-'+a);el[a]=t.elems[a]=g.get('lightbox-'+a)});t.image=new Galleria.Picture();$.each({box:'shadow content close prevholder nextholder',info:'title counter',content:'info image',prevholder:'prev',nextholder:'next'},function(b,c){var d=[];$.each(c.split(' '),function(i,a){d.push(prefix+a)});appends[prefix+b]=d});g.append(appends);$(el.image).append(t.image.container);$(DOM().body).append(el.overlay,el.box);Utils.optimizeTouch(el.box);hover($(el.close).bind('click',t.hide).html('&#215;'));$.each(['Prev','Next'],function(i,a){var b=$(el[a.toLowerCase()]).html(/v/.test(a)?'&#8249;&nbsp;':'&nbsp;&#8250;'),$e=$(el[a.toLowerCase()+'holder']);$e.bind('click',function(){t['show'+a]()});if(IE<8||Galleria.TOUCH){b.show();return}$e.hover(function(){b.show()},function(e){b.stop().fadeOut(200)})});$(el.overlay).bind('click',t.hide);if(Galleria.IPAD){g._options.lightboxTransitionSpeed=0}},rescale:function(b){var c=Math.min($win.width()-40,t.width),height=Math.min($win.height()-60,t.height),ratio=Math.min(c/t.width,height/t.height),destWidth=Math.round(t.width*ratio)+40,destHeight=Math.round(t.height*ratio)+60,to={width:destWidth,height:destHeight,'margin-top':Math.ceil(destHeight/2)*-1,'margin-left':Math.ceil(destWidth/2)*-1};if(b){$(t.elems.box).css(to)}else{$(t.elems.box).animate(to,{duration:g._options.lightboxTransitionSpeed,easing:g._options.easing,complete:function(){var a=t.image,speed=g._options.lightboxFadeSpeed;g.trigger({type:Galleria.LIGHTBOX_IMAGE,imageTarget:a.image});$(a.container).show();$(a.image).animate({opacity:1},speed);Utils.show(t.elems.info,speed)}})}},hide:function(){t.image.image=null;$win.unbind('resize',t.rescale);$(t.elems.box).hide();Utils.hide(t.elems.info);g.detachKeyboard();g.attachKeyboard(t.keymap);t.keymap=false;Utils.hide(t.elems.overlay,200,function(){$(this).hide().css('opacity',g._options.overlayOpacity);g.trigger(Galleria.LIGHTBOX_CLOSE)})},showNext:function(){t.show(g.getNext(t.active))},showPrev:function(){t.show(g.getPrev(t.active))},show:function(b){t.active=b=typeof b==='number'?b:g.getIndex()||0;if(!t.initialized){t.init()}if(!t.keymap){t.keymap=$.extend({},g._keyboard.map);g.attachKeyboard({escape:t.hide,right:t.showNext,left:t.showPrev})}$win.unbind('resize',t.rescale);var c=g.getData(b),total=g.getDataLength(),n=g.getNext(b),ndata,p,i;Utils.hide(t.elems.info);try{for(i=g._options.preload;i>0;i--){p=new Galleria.Picture();ndata=g.getData(n);p.preload('big'in ndata?ndata.big:ndata.image);n=g.getNext(n)}}catch(e){}t.image.isIframe=!!c.iframe;$(t.elems.box).toggleClass('iframe',!!c.iframe);t.image.load(c.iframe||c.big||c.image,function(a){t.width=a.isIframe?$(window).width():a.original.width;t.height=a.isIframe?$(window).height():a.original.height;$(a.image).css({width:a.isIframe?'100%':'100.1%',height:a.isIframe?'100%':'100.1%',top:0,zIndex:99998,opacity:0,visibility:'visible'});t.elems.title.innerHTML=c.title||'';t.elems.counter.innerHTML=(b+1)+' / '+total;$win.resize(t.rescale);t.rescale()});$(t.elems.overlay).show().css('visibility','visible');$(t.elems.box).show()}};return this};Galleria.prototype={constructor:Galleria,init:function(b,c){var d=this;c=_legacyOptions(c);this._original={target:b,options:c,data:null};this._target=this._dom.target=b.nodeName?b:$(b).get(0);this._original.html=this._target.innerHTML;_instances.push(this);if(!this._target){Galleria.raise('Target not found',true);return}this._options={autoplay:false,carousel:true,carouselFollow:true,carouselSpeed:400,carouselSteps:'auto',clicknext:false,dailymotion:{foreground:'%23EEEEEE',highlight:'%235BCEC5',background:'%23222222',logo:0,hideInfos:1},dataConfig:function(a){return{}},dataSelector:'img',dataSource:this._target,debug:u,dummy:u,easing:'galleria',extend:function(a){},fullscreenCrop:u,fullscreenDoubleTap:true,fullscreenTransition:u,height:0,idleMode:true,idleTime:3000,idleSpeed:200,imageCrop:false,imageMargin:0,imagePan:false,imagePanSmoothness:12,imagePosition:'50%',imageTimeout:u,initialTransition:u,keepSource:false,layerFollow:true,lightbox:false,lightboxFadeSpeed:200,lightboxTransitionSpeed:200,linkSourceImages:true,maxScaleRatio:u,minScaleRatio:u,overlayOpacity:0.85,overlayBackground:'#0b0b0b',pauseOnInteraction:true,popupLinks:false,preload:2,queue:true,responsive:false,show:0,showInfo:true,showCounter:true,showImagenav:true,swipe:true,thumbCrop:true,thumbEventType:'click',thumbFit:true,thumbMargin:0,thumbQuality:'auto',thumbnails:true,touchTransition:u,transition:'fade',transitionInitial:u,transitionSpeed:400,trueFullscreen:true,useCanvas:false,vimeo:{title:0,byline:0,portrait:0,color:'aaaaaa'},wait:5000,width:'auto',youtube:{modestbranding:1,autohide:1,color:'white',hd:1,rel:0,showinfo:0}};this._options.initialTransition=this._options.initialTransition||this._options.transitionInitial;if(c&&c.debug===false){DEBUG=false}if(c&&typeof c.imageTimeout==='number'){TIMEOUT=c.imageTimeout}if(c&&typeof c.dummy==='string'){DUMMY=c.dummy}$(this._target).children().hide();if(typeof Galleria.theme==='object'){this._init()}else{_pool.push(this)}return this},_init:function(){var d=this,options=this._options;if(this._initialized){Galleria.raise('Init failed: Gallery instance already initialized.');return this}this._initialized=true;if(!Galleria.theme){Galleria.raise('Init failed: No theme found.',true);return this}$.extend(true,options,Galleria.theme.defaults,this._original.options,Galleria.configure.options);(function(a){if(!('getContext'in a)){a=null;return}_canvas=_canvas||{elem:a,context:a.getContext('2d'),cache:{},length:0}}(doc.createElement('canvas')));this.bind(Galleria.DATA,function(){if(Galleria.QUIRK){Galleria.raise('Your page is in Quirks mode, Galleria may not render correctly. Please validate your HTML.')}this._original.data=this._data;this.get('total').innerHTML=this.getDataLength();var a=this.$('container');var b={width:0,height:0};var c=function(){return d.$('stage').height()};Utils.wait({until:function(){b=d._getWH();a.width(b.width).height(b.height);return c()&&b.width&&b.height>50},success:function(){d._width=b.width;d._height=b.height;if(Galleria.WEBKIT){window.setTimeout(function(){d._run()},1)}else{d._run()}},error:function(){if(c()){Galleria.raise('Could not extract sufficient width/height of the gallery container. Traced measures: width:'+b.width+'px, height: '+b.height+'px.',true)}else{Galleria.raise('Could not extract a stage height from the CSS. Traced height: '+c()+'px.',true)}},timeout:typeof this._options.wait=='number'?this._options.wait:false})});this.append({'info-text':['info-title','info-description'],'info':['info-text'],'image-nav':['image-nav-right','image-nav-left'],'stage':['images','loader','counter','image-nav'],'thumbnails-list':['thumbnails'],'thumbnails-container':['thumb-nav-left','thumbnails-list','thumb-nav-right'],'container':['stage','thumbnails-container','info','tooltip']});Utils.hide(this.$('counter').append(this.get('current'),doc.createTextNode(' / '),this.get('total')));this.setCounter('&#8211;');Utils.hide(d.get('tooltip'));this.$('container').addClass(Galleria.TOUCH?'touch':'notouch');$.each(new Array(2),function(i){var a=new Galleria.Picture();$(a.container).css({position:'absolute',top:0,left:0}).prepend(d._layers[i]=$(Utils.create('galleria-layer')).css({position:'absolute',top:0,left:0,right:0,bottom:0,zIndex:2})[0]);d.$('images').append(a.container);d._controls[i]=a});this.$('images').css({position:'relative',top:0,left:0,width:'100%',height:'100%'});this.$('thumbnails, thumbnails-list').css({overflow:'hidden',position:'relative'});this.$('image-nav-right, image-nav-left').bind('click',function(e){if(options.clicknext){e.stopPropagation()}if(options.pauseOnInteraction){d.pause()}var a=/right/.test(this.className)?'next':'prev';d[a]()});$.each(['info','counter','image-nav'],function(i,a){if(options['show'+a.substr(0,1).toUpperCase()+a.substr(1).replace(/-/,'')]===false){Utils.moveOut(d.get(a.toLowerCase()))}});this.load();if(!options.keepSource&&!IE){this._target.innerHTML=''}if(this.get('errors')){this.appendChild('target','errors')}this.appendChild('target','container');if(options.carousel){var f=0,show=options.show;this.bind(Galleria.THUMBNAIL,function(){this.updateCarousel();if(++f==this.getDataLength()&&typeof show=='number'&&show>0){this._carousel.follow(show)}})}if(options.responsive){$win.bind('resize',function(){if(!d.isFullscreen()){d.resize()}})}if(options.swipe){(function(a){var b=[0,0],swipeStop=[0,0],limitX=30,limitY=100,multi=false,tid=0,data,ev={start:'touchstart',move:'touchmove',stop:'touchend'},getData=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e},moveHandler=function(e){if(e.originalEvent.touches&&e.originalEvent.touches.length>1){return}data=getData(e);swipeStop=[data.pageX,data.pageY];if(!b[0]){b=swipeStop}if(Math.abs(b[0]-swipeStop[0])>10){e.preventDefault()}},upHandler=function(e){a.unbind(ev.move,moveHandler);if((e.originalEvent.touches&&e.originalEvent.touches.length)||multi){multi=!multi;return}if(Utils.timestamp()-tid<1000&&Math.abs(b[0]-swipeStop[0])>limitX&&Math.abs(b[1]-swipeStop[1])<limitY){e.preventDefault();d[b[0]>swipeStop[0]?'next':'prev']()}b=swipeStop=[0,0]};a.bind(ev.start,function(e){if(e.originalEvent.touches&&e.originalEvent.touches.length>1){return}data=getData(e);tid=Utils.timestamp();b=swipeStop=[data.pageX,data.pageY];a.bind(ev.move,moveHandler).one(ev.stop,upHandler)})}(d.$('images')));if(options.fullscreenDoubleTap){this.$('stage').bind('touchstart',(function(){var a,cx,cy,lx,ly,now,getData=function(e){return e.originalEvent.touches?e.originalEvent.touches[0]:e};return function(e){now=Galleria.utils.timestamp();cx=getData(e).pageX;cy=getData(e).pageY;if((now-a<500)&&(cx-lx<20)&&(cy-ly<20)){d.toggleFullscreen();e.preventDefault();d.$('stage').unbind('touchend',arguments.callee);return}a=now;lx=cx;ly=cy}}()))}}Utils.optimizeTouch(this.get('container'));$.each(Galleria.on.binds,function(i,a){d.bind(a.type,a.callback)});return this},_getWH:function(){var a=this.$('container'),$target=this.$('target'),self=this,num={},arr;$.each(['width','height'],function(i,m){if(self._options[m]&&typeof self._options[m]==='number'){num[m]=self._options[m]}else{arr=[Utils.parseValue(a.css(m)),Utils.parseValue($target.css(m)),a[m](),$target[m]()];if(!self['_'+m]){arr.splice(arr.length,Utils.parseValue(a.css('min-'+m)),Utils.parseValue($target.css('min-'+m)))}num[m]=Math.max.apply(Math,arr)}});if(self._options.height&&self._options.height<2){num.height=num.width*self._options.height}return num},_createThumbnails:function(){this.get('total').innerHTML=this.getDataLength();var i,src,thumb,data,special,$container,self=this,o=this._options,active=(function(){var a=self.$('thumbnails').find('.active');if(!a.length){return false}return a.find('img').attr('src')}()),optval=typeof o.thumbnails==='string'?o.thumbnails.toLowerCase():null,getStyle=function(a){return doc.defaultView&&doc.defaultView.getComputedStyle?doc.defaultView.getComputedStyle(thumb.container,null)[a]:$container.css(a)},fake=function(a,b,c){return function(){$(c).append(a);self.trigger({type:Galleria.THUMBNAIL,thumbTarget:a,index:b,galleriaData:self.getData(b)})}},onThumbEvent=function(e){if(o.pauseOnInteraction){self.pause()}var a=$(e.currentTarget).data('index');if(self.getIndex()!==a){self.show(a)}e.preventDefault()},onThumbLoad=function(e){e.scale({width:e.data.width,height:e.data.height,crop:o.thumbCrop,margin:o.thumbMargin,canvas:o.useCanvas,complete:function(c){var d=['left','top'],arr=['Width','Height'],m,css,data=self.getData(c.index),special=data.thumb.split(':');$.each(arr,function(i,a){m=a.toLowerCase();if((o.thumbCrop!==true||o.thumbCrop===m)&&o.thumbFit){css={};css[m]=c[m];$(c.container).css(css);css={};css[d[i]]=0;$(c.image).css(css)}c['outer'+a]=$(c.container)['outer'+a](true)});Utils.toggleQuality(c.image,o.thumbQuality===true||(o.thumbQuality==='auto'&&c.original.width<c.width*3));if(data.iframe&&special.length==2&&special[0]in _video){_video[special[0]].getThumb(special[1],(function(b){return function(a){b.src=a}}(c.image)))}self.trigger({type:Galleria.THUMBNAIL,thumbTarget:c.image,index:c.data.order,galleriaData:self.getData(c.data.order)})}})};this._thumbnails=[];this.$('thumbnails').empty();for(i=0;this._data[i];i++){data=this._data[i];if(o.thumbnails===true&&(data.thumb||data.image)){thumb=new Galleria.Picture(i);thumb.index=i;src=data.thumb||data.image;this.$('thumbnails').append(thumb.container);$container=$(thumb.container);thumb.data={width:Utils.parseValue(getStyle('width')),height:Utils.parseValue(getStyle('height')),order:i};if(o.thumbFit&&o.thumbCrop!==true){$container.css({width:'auto',height:'auto'})}else{$container.css({width:thumb.data.width,height:thumb.data.height})}special=src.split(':');if(special.length==2&&special[0]in _video){thumb.load('data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw%3D%3D',{height:thumb.data.height,width:thumb.data.height*1.25},onThumbLoad)}else{thumb.load(src,onThumbLoad)}if(o.preload==='all'){thumb.preload(data.image)}}else if(data.iframe||optval==='empty'||optval==='numbers'){thumb={container:Utils.create('galleria-image'),image:Utils.create('img','span'),ready:true};if(optval==='numbers'){$(thumb.image).text(i+1)}if(data.iframe){$(thumb.image).addClass('iframe')}this.$('thumbnails').append(thumb.container);window.setTimeout((fake)(thumb.image,i,thumb.container),50+(i*20))}else{thumb={container:null,image:null}}$(thumb.container).add(o.keepSource&&o.linkSourceImages?data.original:null).data('index',i).bind(o.thumbEventType,onThumbEvent);if(active===src){$(thumb.container).addClass('active')}this._thumbnails.push(thumb)}},_run:function(){var b=this;b._createThumbnails();Utils.wait({timeout:10000,until:function(){if(Galleria.OPERA){b.$('stage').css('display','inline-block')}b._stageWidth=b.$('stage').width();b._stageHeight=b.$('stage').height();return(b._stageWidth&&b._stageHeight>50)},success:function(){_galleries.push(b);Utils.show(b.get('counter'));if(b._options.carousel){b._carousel.bindControls()}if(b._options.autoplay){b.pause();if(typeof b._options.autoplay==='number'){b._playtime=b._options.autoplay}b.trigger(Galleria.PLAY);b._playing=true}if(b._firstrun){if(typeof b._options.show==='number'){b.show(b._options.show)}return}b._firstrun=true;if(Galleria.History){Galleria.History.change(function(a){if(isNaN(a)){window.history.go(-1)}else{b.show(a,u,true)}})}b.trigger(Galleria.READY);Galleria.theme.init.call(b,b._options);$.each(Galleria.ready.callbacks,function(){this.call(b,b._options)});b._options.extend.call(b,b._options);if(/^[0-9]{1,4}$/.test(HASH)&&Galleria.History){b.show(HASH,u,true)}else if(b._data[b._options.show]){b.show(b._options.show)}},error:function(){Galleria.raise('Stage width or height is too small to show the gallery. Traced measures: width:'+b._stageWidth+'px, height: '+b._stageHeight+'px.',true)}})},load:function(d,e,f){var g=this;this._data=[];this._thumbnails=[];this.$('thumbnails').empty();if(typeof e==='function'){f=e;e=null}d=d||this._options.dataSource;e=e||this._options.dataSelector;f=f||this._options.dataConfig;if(/^function Object/.test(d.constructor)){d=[d]}if(d.constructor===Array){if(this.validate(d)){this._data=d;this._parseData().trigger(Galleria.DATA)}else{Galleria.raise('Load failed: JSON Array not valid.')}return this}e+=',.video,.iframe';g.titles=$(d).find(".shiba-link");if(g._options.lightbox){g.titles.bind('click',function(a){g.openLightbox()})}$(d).find(e).each(function(i,b){b=$(b);var c={},parent=b.parent(),href=parent.attr('href'),rel=parent.attr('rel');if(href&&(b[0].nodeName=='IMG'||b.hasClass('video'))&&_videoTest(href)){c.video=href}else if(href&&b.hasClass('iframe')){c.iframe=href}else{c.image=c.big=href}if(rel){c.big=rel}$.each('big title description link layer'.split(' '),function(j,a){if(b.data(a)){c[a]=b.data(a)}});g._data.push($.extend({title:b.attr('title')||'',thumb:b.attr('src'),image:b.attr('src'),big:b.attr('src'),description:b.attr('alt')||'',link:b.attr('longdesc'),original:b.get(0)},c,f(b)))});if(this.getDataLength()){this._parseData().trigger(Galleria.DATA)}else{Galleria.raise('Load failed: no data found.')}return this},_parseData:function(){var f=this,current;$.each(this._data,function(i,d){current=f._data[i];if('thumb'in d===false){current.thumb=d.image}if(!'big'in d){current.big=d.image}if('video'in d){var e=_videoTest(d.video);if(e){current.iframe=_video[e.provider].embed(e.id)+(function(){if(typeof f._options[e.provider]=='object'){var c='?',arr=[];$.each(f._options[e.provider],function(a,b){arr.push(a+'='+b)});if(e.provider=='youtube'){arr=['wmode=opaque'].concat(arr)}return c+arr.join('&')}return''}());delete current.video;if(!('thumb'in current)||!current.thumb){current.thumb=e.provider+':'+e.id}}}});return this},destroy:function(){this.get('target').innerHTML=this._original.html;return this},splice:function(){var a=this,args=Utils.array(arguments);window.setTimeout(function(){protoArray.splice.apply(a._data,args);a._parseData()._createThumbnails()},2);return a},push:function(){var a=this,args=Utils.array(arguments);window.setTimeout(function(){protoArray.push.apply(a._data,args);a._parseData()._createThumbnails()},2);return a},_getActive:function(){return this._controls.getActive()},validate:function(a){return true},bind:function(a,b){a=_patchEvent(a);this.$('container').bind(a,this.proxy(b));return this},unbind:function(a){a=_patchEvent(a);this.$('container').unbind(a);return this},trigger:function(a){a=typeof a==='object'?$.extend(a,{scope:this}):{type:_patchEvent(a),scope:this};this.$('container').trigger(a);return this},addIdleState:function(a,b){this._idle.add.apply(this._idle,Utils.array(arguments));return this},removeIdleState:function(a){this._idle.remove.apply(this._idle,Utils.array(arguments));return this},enterIdleMode:function(){this._idle.hide();return this},exitIdleMode:function(){this._idle.showAll();return this},enterFullscreen:function(a){this._fullscreen.enter.apply(this,Utils.array(arguments));return this},exitFullscreen:function(a){this._fullscreen.exit.apply(this,Utils.array(arguments));return this},toggleFullscreen:function(a){this._fullscreen[this.isFullscreen()?'exit':'enter'].apply(this,Utils.array(arguments));return this},bindTooltip:function(a,b){this._tooltip.bind.apply(this._tooltip,Utils.array(arguments));return this},defineTooltip:function(a,b){this._tooltip.define.apply(this._tooltip,Utils.array(arguments));return this},refreshTooltip:function(a){this._tooltip.show.apply(this._tooltip,Utils.array(arguments));return this},openLightbox:function(){this._lightbox.show.apply(this._lightbox,Utils.array(arguments));return this},closeLightbox:function(){this._lightbox.hide.apply(this._lightbox,Utils.array(arguments));return this},getActiveImage:function(){return this._getActive().image||u},getActiveThumb:function(){return this._thumbnails[this._active].image||u},getMousePosition:function(e){return{x:e.pageX-this.$('container').offset().left,y:e.pageY-this.$('container').offset().top}},addPan:function(f){if(this._options.imageCrop===false){return}f=$(f||this.getActiveImage());var g=this,x=f.width()/2,y=f.height()/2,destX=parseInt(f.css('left'),10),destY=parseInt(f.css('top'),10),curX=destX||0,curY=destY||0,distX=0,distY=0,active=false,ts=Utils.timestamp(),cache=0,move=0,position=function(a,b,c){if(a>0){move=Math.round(Math.max(a*-1,Math.min(0,b)));if(cache!==move){cache=move;if(IE===8){f.parent()['scroll'+c](move*-1)}else{var d={};d[c.toLowerCase()]=move;f.css(d)}}}},calculate=function(e){if(Utils.timestamp()-ts<50){return}active=true;x=g.getMousePosition(e).x;y=g.getMousePosition(e).y},loop=function(e){if(!active){return}distX=f.width()-g._stageWidth;distY=f.height()-g._stageHeight;destX=x/g._stageWidth*distX*-1;destY=y/g._stageHeight*distY*-1;curX+=(destX-curX)/g._options.imagePanSmoothness;curY+=(destY-curY)/g._options.imagePanSmoothness;position(distY,curY,'Top');position(distX,curX,'Left')};if(IE===8){f.parent().scrollTop(curY*-1).scrollLeft(curX*-1);f.css({top:0,left:0})}this.$('stage').unbind('mousemove',calculate).bind('mousemove',calculate);Utils.addTimer('pan'+g._id,loop,50,true);return this},proxy:function(a,b){if(typeof a!=='function'){return F}b=b||this;return function(){return a.apply(b,Utils.array(arguments))}},removePan:function(){this.$('stage').unbind('mousemove');Utils.clearTimer('pan'+this._id);return this},addElement:function(b){var c=this._dom;$.each(Utils.array(arguments),function(i,a){c[a]=Utils.create('galleria-'+a)});return this},attachKeyboard:function(a){this._keyboard.attach.apply(this._keyboard,Utils.array(arguments));return this},detachKeyboard:function(){this._keyboard.detach.apply(this._keyboard,Utils.array(arguments));return this},appendChild:function(a,b){this.$(a).append(this.get(b)||b);return this},prependChild:function(a,b){this.$(a).prepend(this.get(b)||b);return this},remove:function(a){this.$(Utils.array(arguments).join(',')).remove();return this},append:function(a){var i,j;for(i in a){if(a.hasOwnProperty(i)){if(a[i].constructor===Array){for(j=0;a[i][j];j++){this.appendChild(i,a[i][j])}}else{this.appendChild(i,a[i])}}}return this},_scaleImage:function(b,c){b=b||this._controls.getActive();if(!b){return}var d=this,complete,scaleLayer=function(a){$(a.container).children(':first').css({top:Math.max(0,Utils.parseValue(a.image.style.top)),left:Math.max(0,Utils.parseValue(a.image.style.left)),width:Utils.parseValue(a.image.width),height:Utils.parseValue(a.image.height)})};c=$.extend({width:this._stageWidth,height:this._stageHeight,crop:this._options.imageCrop,max:this._options.maxScaleRatio,min:this._options.minScaleRatio,margin:this._options.imageMargin,position:this._options.imagePosition},c);if(this._options.layerFollow&&this._options.imageCrop!==true){if(typeof c.complete=='function'){complete=c.complete;c.complete=function(){complete.call(b,b);scaleLayer(b)}}else{c.complete=scaleLayer}}else{$(b.container).children(':first').css({top:0,left:0})}b.scale(c);return this},updateCarousel:function(){this._carousel.update();return this},resize:function(b,c){if(typeof b=='function'){c=b;b=u}b=$.extend({width:0,height:0},b);var d=this,$container=this.$('container'),aspect=this._options.responsive=='aspect'&&(!b.width||!b.height),ratio;$.each(b,function(m,a){if(!a){$container[m]('auto');b[m]=d._getWH()[m]}});if(aspect){ratio=Math.min(b.width/this._width,b.height/this._height)}$.each(b,function(m,a){$container[m](ratio?ratio*d['_'+m]:a)});return this.rescale(c)},rescale:function(a,b,c){var d=this;if(typeof a==='function'){c=a;a=u}var e=function(){d._stageWidth=a||d.$('stage').width();d._stageHeight=b||d.$('stage').height();d._scaleImage();if(d._options.carousel){d.updateCarousel()}d.trigger(Galleria.RESCALE);if(typeof c==='function'){c.call(d)}};if(Galleria.WEBKIT&&!Galleria.TOUCH&&!a&&!b){Utils.addTimer(false,e,10)}else{e.call(d)}return this},refreshImage:function(){this._scaleImage();if(this._options.imagePan){this.addPan()}return this},show:function(a,b,c){if(a===false||(!this._options.queue&&this._queue.stalled)){return}a=Math.max(0,Math.min(parseInt(a,10),this.getDataLength()-1));b=typeof b!=='undefined'?!!b:a<this.getIndex();c=c||false;if(!c&&Galleria.History){Galleria.History.set(a.toString());return}this._active=a;protoArray.push.call(this._queue,{index:a,rewind:b});if(!this._queue.stalled){this._show()}return this},_show:function(){var h=this,queue=this._queue[0],data=this.getData(queue.index);if(!data){return}var j=data.iframe||(this.isFullscreen()&&'big'in data?data.big:data.image),active=this._controls.getActive(),next=this._controls.getNext(),cached=next.isCached(j),thumb=this._thumbnails[queue.index],mousetrigger=function(){$(next.image).trigger('mouseup')};var k=(function(b,c,d,e,f){return function(){var a;h._queue.stalled=false;Utils.toggleQuality(c.image,h._options.imageQuality);h._layers[h._controls.active].innerHTML='';$(d.container).css({zIndex:0,opacity:0}).show();if(d.isIframe){$(d.container).find('iframe').remove()}h.$('container').toggleClass('iframe',!!b.iframe);$(c.container).css({zIndex:1,left:0,top:0}).show();h._controls.swap();if(h._options.imagePan){h.addPan(c.image)}if(b.link||h._options.lightbox||h._options.clicknext){$(c.image).css({cursor:'pointer'}).bind('mouseup',function(){if(h._options.clicknext){if(h._options.pauseOnInteraction){h.pause()}h.next();return}if(h.titles[e.index]){$(h.titles[e.index])[0].click();return}if(b.link){if(h._options.popupLinks){a=window.open(b.link,'_blank')}else{window.location.href=b.link}return}if(h._options.lightbox){h.openLightbox()}})}protoArray.shift.call(h._queue);if(h._queue.length){h._show()}h._playCheck();h.trigger({type:Galleria.IMAGE,index:e.index,imageTarget:c.image,thumbTarget:f.image,galleriaData:b})}}(data,next,active,queue,thumb));if(this._options.carousel&&this._options.carouselFollow){this._carousel.follow(queue.index)}if(this._options.preload){var p,i,n=this.getNext(),ndata;try{for(i=this._options.preload;i>0;i--){p=new Galleria.Picture();ndata=h.getData(n);p.preload(this.isFullscreen()&&'big'in ndata?ndata.big:ndata.image);n=h.getNext(n)}}catch(e){}}Utils.show(next.container);next.isIframe=!!data.iframe;$(h._thumbnails[queue.index].container).addClass('active').siblings('.active').removeClass('active');h.trigger({type:Galleria.LOADSTART,cached:cached,index:queue.index,rewind:queue.rewind,imageTarget:next.image,thumbTarget:thumb.image,galleriaData:data});next.load(j,function(f){var g=$(h._layers[1-h._controls.active]).html(data.layer||'').hide();h._scaleImage(f,{complete:function(c){if('image'in active){Utils.toggleQuality(active.image,false)}Utils.toggleQuality(c.image,false);h._queue.stalled=true;h.removePan();h.setInfo(queue.index);h.setCounter(queue.index);if(data.layer){g.show();if(data.link||h._options.lightbox||h._options.clicknext){g.css('cursor','pointer').unbind('mouseup').mouseup(mousetrigger)}}h.trigger({type:Galleria.LOADFINISH,cached:cached,index:queue.index,rewind:queue.rewind,imageTarget:c.image,thumbTarget:h._thumbnails[queue.index].image,galleriaData:h.getData(queue.index)});var d=h._options.transition;$.each({initial:active.image===null,touch:Galleria.TOUCH,fullscreen:h.isFullscreen()},function(a,b){if(b&&h._options[a+'Transition']!==u){d=h._options[a+'Transition'];return false}});if(d in _transitions===false){k()}else{var e={prev:active.container,next:c.container,rewind:queue.rewind,speed:h._options.transitionSpeed||400};_transitions[d].call(h,e,k)}}})})},getNext:function(a){a=typeof a==='number'?a:this.getIndex();return a===this.getDataLength()-1?0:a+1},getPrev:function(a){a=typeof a==='number'?a:this.getIndex();return a===0?this.getDataLength()-1:a-1},next:function(){if(this.getDataLength()>1){this.show(this.getNext(),false)}return this},prev:function(){if(this.getDataLength()>1){this.show(this.getPrev(),true)}return this},get:function(a){return a in this._dom?this._dom[a]:null},getData:function(a){return a in this._data?this._data[a]:this._data[this._active]},getDataLength:function(){return this._data.length},getIndex:function(){return typeof this._active==='number'?this._active:false},getStageHeight:function(){return this._stageHeight},getStageWidth:function(){return this._stageWidth},getOptions:function(a){return typeof a==='undefined'?this._options:this._options[a]},setOptions:function(a,b){if(typeof a==='object'){$.extend(this._options,a)}else{this._options[a]=b}return this},play:function(a){this._playing=true;this._playtime=a||this._playtime;this._playCheck();this.trigger(Galleria.PLAY);return this},pause:function(){this._playing=false;this.trigger(Galleria.PAUSE);return this},playToggle:function(a){return(this._playing)?this.pause():this.play(a)},isPlaying:function(){return this._playing},isFullscreen:function(){return this._fullscreen.active},_playCheck:function(){var a=this,played=0,interval=20,now=Utils.timestamp(),timer_id='play'+this._id;if(this._playing){Utils.clearTimer(timer_id);var b=function(){played=Utils.timestamp()-now;if(played>=a._playtime&&a._playing){Utils.clearTimer(timer_id);a.next();return}if(a._playing){a.trigger({type:Galleria.PROGRESS,percent:Math.ceil(played/a._playtime*100),seconds:Math.floor(played/1000),milliseconds:played});Utils.addTimer(timer_id,b,interval)}};Utils.addTimer(timer_id,b,interval)}},setPlaytime:function(a){this._playtime=a;return this},setIndex:function(a){this._active=a;return this},setCounter:function(a){if(typeof a==='number'){a++}else if(typeof a==='undefined'){a=this.getIndex()+1}this.get('current').innerHTML=a;if(IE){var b=this.$('counter'),opacity=b.css('opacity');if(parseInt(opacity,10)===1){Utils.removeAlpha(b[0])}else{this.$('counter').css('opacity',opacity)}}return this},setInfo:function(c){var d=this,data=this.getData(c);$.each(['title','description'],function(i,a){var b=d.$('info-'+a);if((a=='title')&&d.titles[c]){b.children().detach();$(d.titles[c]).show();d.titles[c].innerText=data[a];b[data[a].length?'show':'hide']().append(d.titles[c])}else if(!!data[a]){b[data[a].length?'show':'hide']().html(data[a])}else{b.empty().hide()}});return this},hasInfo:function(a){var b='title description'.split(' '),i;for(i=0;b[i];i++){if(!!this.getData(a)[b[i]]){return true}}return false},jQuery:function(b){var c=this,ret=[];$.each(b.split(','),function(i,a){a=$.trim(a);if(c.get(a)){ret.push(a)}});var d=$(c.get(ret.shift()));$.each(ret,function(i,a){d=d.add(c.get(a))});return d},$:function(a){return this.jQuery.apply(this,Utils.array(arguments))}};$.each(_events,function(i,a){var b=/_/.test(a)?a.replace(/_/g,''):a;Galleria[a.toUpperCase()]='galleria.'+b});$.extend(Galleria,{IE9:IE===9,IE8:IE===8,IE7:IE===7,IE6:IE===6,IE:IE,WEBKIT:/webkit/.test(NAV),CHROME:/chrome/.test(NAV),SAFARI:/safari/.test(NAV)&&!(/chrome/.test(NAV)),QUIRK:(IE&&doc.compatMode&&doc.compatMode==="BackCompat"),MAC:/mac/.test(navigator.platform.toLowerCase()),OPERA:!!window.opera,IPHONE:/iphone/.test(NAV),IPAD:/ipad/.test(NAV),ANDROID:/android/.test(NAV),TOUCH:('ontouchstart'in doc)});Galleria.addTheme=function(b){if(!b.name){Galleria.raise('No theme name specified')}if(typeof b.defaults!=='object'){b.defaults={}}else{b.defaults=_legacyOptions(b.defaults)}var c=false,reg;if(typeof b.css==='string'){$('link').each(function(i,a){reg=new RegExp(b.css);if(reg.test(a.href)){c=true;_themeLoad(b);return false}});if(!c){$('script').each(function(i,a){reg=new RegExp('galleria\\.'+b.name.toLowerCase()+'\\.');if(reg.test(a.src)){c=a.src.replace(/[^\/]*$/,'')+b.css;Utils.addTimer("css",function(){Utils.loadCSS(c,'galleria-theme',function(){_themeLoad(b)})},1)}})}if(!c){Galleria.raise('No theme CSS loaded')}}else{_themeLoad(b)}return b};Galleria.loadTheme=function(d,e){var f=false,length=_galleries.length,err=window.setTimeout(function(){Galleria.raise("Theme at "+d+" could not load, check theme path.",true)},5000);Galleria.theme=u;Utils.loadScript(d,function(){window.clearTimeout(err);if(length){var c=[];$.each(Galleria.get(),function(i,a){var b=$.extend(a._original.options,{data_source:a._data},e);a.$('container').remove();var g=new Galleria();g._id=a._id;g.init(a._original.target,b);c.push(g)});_galleries=c}});return Galleria};Galleria.get=function(a){if(!!_instances[a]){return _instances[a]}else if(typeof a!=='number'){return _instances}else{Galleria.raise('Gallery index '+a+' not found')}};Galleria.configure=function(b,c){var d={};if(typeof b=='string'&&c){d[b]=c;b=d}else{$.extend(d,b)}Galleria.configure.options=d;$.each(Galleria.get(),function(i,a){a.setOptions(d)});return Galleria};Galleria.configure.options={};Galleria.on=function(b,c){if(!b){return}Galleria.on.binds.push({type:b,callback:c||F});$.each(Galleria.get(),function(i,a){a.bind(b,c)});return Galleria};Galleria.on.binds=[];Galleria.run=function(a,b){$(a||'#galleria').galleria(b);return Galleria};Galleria.addTransition=function(a,b){_transitions[a]=b;return Galleria};Galleria.utils=Utils;Galleria.log=(function(){if('console'in window&&'log'in window.console){return window.console.log}else{return function(){window.alert(Utils.array(arguments).join(', '))}}}());Galleria.ready=function(b){$.each(_galleries,function(i,a){b.call(a,a._options)});Galleria.ready.callbacks.push(b);return Galleria};Galleria.ready.callbacks=[];Galleria.raise=function(d,e){var f=e?'Fatal error':'Error',self=this,css={color:'#fff',position:'absolute',top:0,left:0,zIndex:100000},echo=function(b){var c='<div style="padding:4px;margin:0 0 2px;background:#'+(e?'811':'222')+'";>'+(e?'<strong>'+f+': </strong>':'')+b+'</div>';$.each(_instances,function(){var a=this.$('errors'),target=this.$('target');if(!a.length){target.css('position','relative');a=this.addElement('errors').appendChild('target','errors').$('errors').css(css)}a.append(c)});if(!_instances.length){$('<div>').css($.extend(css,{position:'fixed'})).append(c).appendTo(DOM().body)}};if(DEBUG){echo(d);if(e){throw new Error(f+': '+d);}}else if(e){if(_hasError){return}_hasError=true;e=false;echo('Gallery could not load.')}};Galleria.version=VERSION;Galleria.requires=function(a,b){b=b||'You need to upgrade Galleria to version '+a+' to use one or more components.';if(Galleria.version<a){Galleria.raise(b,true)}return Galleria};Galleria.Picture=function(a){this.id=a||null;this.image=null;this.container=Utils.create('galleria-image');$(this.container).css({overflow:'hidden',position:'relative'});this.original={width:0,height:0};this.ready=false;this.isIframe=false};Galleria.Picture.prototype={cache:{},show:function(){Utils.show(this.image)},hide:function(){Utils.moveOut(this.image)},clear:function(){this.image=null},isCached:function(a){return!!this.cache[a]},preload:function(c){$(new Image()).load((function(a,b){return function(){b[a]=a}}(c,this.cache))).attr('src',c)},load:function(f,g,h){if(typeof g=='function'){h=g;g=null}if(this.isIframe){var j='if'+new Date().getTime();this.image=$('<iframe>',{src:f,frameborder:0,id:j,allowfullscreen:true,css:{visibility:'hidden'}})[0];$(this.container).find('iframe,img').remove();this.container.appendChild(this.image);$('#'+j).load((function(a,b){return function(){window.setTimeout(function(){$(a.image).css('visibility','visible');if(typeof b=='function'){b.call(a,a)}},10)}}(this,h)));return this.container}this.image=new Image();var i=0,reload=false,resort=false,$container=$(this.container),$image=$(this.image),onload=(function(c,d,e){return function(){var b=function(){$(this).unbind('load');c.original=g||{height:this.height,width:this.width};c.container.appendChild(this);c.cache[e]=e;if(typeof d=='function'){window.setTimeout(function(){d.call(c,c)},1)}};if((!this.width||!this.height)){window.setTimeout((function(a){return function(){if(a.width&&a.height){b.call(a)}else{if(!resort){$(new Image()).load(onload).attr('src',a.src);resort=true}else{Galleria.raise('Could not extract width/height from image: '+a.src+'. Traced measures: width:'+a.width+'px, height: '+a.height+'px.')}}}}(this)),2)}else{b.call(this)}}}(this,h,f));$container.find('iframe,img').remove();$image.css('display','block');Utils.hide(this.image);$.each('minWidth minHeight maxWidth maxHeight'.split(' '),function(i,a){$image.css(a,(/min/.test(a)?'0':'none'))});if(this.cache[f]){$image.load(onload).attr('src',f);return this.container}$image.load(onload).error(function(){if(!reload){reload=true;window.setTimeout((function(a,b){return function(){a.attr('src',b+'?'+Utils.timestamp())}}($(this),f)),50)}else{if(DUMMY){$(this).attr('src',DUMMY)}else{Galleria.raise('Image not found: '+f)}}}).attr('src',f);return this.container},scale:function(h){var j=this;h=$.extend({width:0,height:0,min:u,max:u,margin:0,complete:F,position:'center',crop:false,canvas:false},h);if(this.isIframe){$(this.image).width(h.width).height(h.height).removeAttr('width').removeAttr('height');$(this.container).width(h.width).height(h.height);h.complete.call(j,j);try{if(this.image.contentWindow){$(this.image.contentWindow).trigger('resize')}}catch(e){}return this.container}if(!this.image){return this.container}var k,height,$container=$(j.container),data;Utils.wait({until:function(){k=h.width||$container.width()||Utils.parseValue($container.css('width'));height=h.height||$container.height()||Utils.parseValue($container.css('height'));return k&&height},success:function(){var f=(k-h.margin*2)/j.original.width,newHeight=(height-h.margin*2)/j.original.height,min=Math.min(f,newHeight),max=Math.max(f,newHeight),cropMap={'true':max,'width':f,'height':newHeight,'false':min,'landscape':j.original.width>j.original.height?max:min,'portrait':j.original.width<j.original.height?max:min},ratio=cropMap[h.crop.toString()],canvasKey='';if(h.max){ratio=Math.min(h.max,ratio)}if(h.min){ratio=Math.max(h.min,ratio)}$.each(['width','height'],function(i,m){$(j.image)[m](j[m]=j.image[m]=Math.round(j.original[m]*ratio))});$(j.container).width(k).height(height);if(h.canvas&&_canvas){_canvas.elem.width=j.width;_canvas.elem.height=j.height;canvasKey=j.image.src+':'+j.width+'x'+j.height;j.image.src=_canvas.cache[canvasKey]||(function(a){_canvas.context.drawImage(j.image,0,0,j.original.width*ratio,j.original.height*ratio);try{data=_canvas.elem.toDataURL();_canvas.length+=data.length;_canvas.cache[a]=data;return data}catch(e){return j.image.src}}(canvasKey))}var g={},mix={},getPosition=function(a,b,c){var d=0;if(/\%/.test(a)){var e=parseInt(a,10)/100,m=j.image[b]||$(j.image)[b]();d=Math.ceil(m*-1*e+c*e)}else{d=Utils.parseValue(a)}return d},positionMap={'top':{top:0},'left':{left:0},'right':{left:'100%'},'bottom':{top:'100%'}};$.each(h.position.toLowerCase().split(' '),function(i,a){if(a==='center'){a='50%'}g[i?'top':'left']=a});$.each(g,function(i,a){if(positionMap.hasOwnProperty(a)){$.extend(mix,positionMap[a])}});g=g.top?$.extend(g,mix):mix;g=$.extend({top:'50%',left:'50%'},g);$(j.image).css({position:'absolute',top:getPosition(g.top,'height',height),left:getPosition(g.left,'width',k)});j.show();j.ready=true;h.complete.call(j,j)},error:function(){Galleria.raise('Could not scale image: '+j.image.src)},timeout:1000});return this}};$.extend($.easing,{galleria:function(_,t,b,c,d){if((t/=d/2)<1){return c/2*t*t*t+b}return c/2*((t-=2)*t*t+2)+b},galleriaIn:function(_,t,b,c,d){return c*(t/=d)*t+b},galleriaOut:function(_,t,b,c,d){return-c*(t/=d)*(t-2)+b}});$.fn.galleria=function(a){var b=this.selector;if(!$(this).length){$(function(){if($(b).length){$(b).galleria(a)}else{Galleria.utils.wait({until:function(){return $(b).length},success:function(){$(b).galleria(a)},error:function(){Galleria.raise('Init failed: Galleria could not find the element "'+b+'".')},timeout:5000})}});return this}return this.each(function(){if(!$.data(this,'galleria')){$.data(this,'galleria',new Galleria().init(this,a))}})}}(jQuery));